(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{288:function(t,e,n){"use strict";n.r(e);var a=n(28),s=Object(a.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"跨文档交流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跨文档交流"}},[t._v("#")]),t._v(" 跨文档交流")]),t._v(" "),n("blockquote",[n("p",[t._v("转自 https://www.liyao1994.top/\n定义：跨文档消息传送，也简称为XDM，指的是来自不同域页面间传递消息。\n使用场景：iframe的使用，父子页面的数据传输")])]),t._v(" "),n("h2",{attrs:{id:"ifarme"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ifarme"}},[t._v("#")]),t._v(" ifarme")]),t._v(" "),n("p",[t._v("这里不多做介绍。就提几点需要注意的："),n("br"),t._v("\n1.https 协议下的ifarem是无法打开 http协议的页面的，因为不安全")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("解决办法：\n1.购买SSL ，http添加证书变为https(有免费的SSL，需要自己去搜索)\n\n2.通过配置nginx代理，映射到当前https的域名\n")])])]),n("p",[t._v("2.页面中，父子页面处于不同域名下时，父子页面无法获得对方document的操作权限，包括高度等的获取\n场景：嵌套子页面以后，父页面需要获取子页面的高度，因为跨域的原因，无法获取，因为无法获得子页面的dom的操作权限")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("解决办法：\n1. nginx代理，将子页面映射到当前父页面域名下(有诸多弊端，比如子页面的一些资源情况等等，很难去处理)\n\n2.利用postMessage 和 message的方法。（前提是双方都需要修改自己的代码）  \n因为有很多情况 是我们去放置第三方的页面，只能对自身的代码进行修改，所以这种方法有限制\n")])])]),n("h2",{attrs:{id:"postmessage-与-message的具体用法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#postmessage-与-message的具体用法"}},[t._v("#")]),t._v(" postMessage 与 message的具体用法")]),t._v(" "),n("p",[t._v("场景：home.html（父页面） msg.html（子页面）")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("home.html\n<body>\n<iframe src='msg.html' width='400' height ='400' onload='sendMsg()' is='iframe'></iframe>\n<script>\nfunction sendMsg(){\n\tvar iframes = document.getElementById('iframe').contentWindow;\n\tvar list = {'name':'张三','age':18};\n\t// postMessage 第一个参数：需要传递的消息内容\n\t// 第二个参数：接受消息的对象窗口Url,一般与iframe的src一致(用于安全考虑)\n\tsetTimeout(function(){\n\t\tiframes.postMessage(list,'http://xxxxxx');\t\n\t},1000)\t\n}\n<\/script>\n\n</body>\n")])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("msg.html\n\n<body>\n<script>\n//event.data 传过来的数据 event.origin 第二个参数 ，eventsource 作为目标文档的window的引用，作为单次握手的操做回应\nwindow.addEventListener('message', function(event) {\n\tif(event.origin == 'http://xxxxxx'){\n\t\tvar data = event.data;\n\t\tconsole.log(\"收到了数据： \",data);\n\t\tsetTimeout(function(){\n\t\t\tevent.source.postMessage('已经收到了消息')\n\t\t},2000)\t\t\n\t}\t\n}, false);\n\n<\/script>\n\n</body>\n\n")])])]),n("h2",{attrs:{id:"同域名的情况下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#同域名的情况下"}},[t._v("#")]),t._v(" 同域名的情况下")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("<script>\nfunction sendMsg(){\n\ttry{\n\t\tvar iframe = document.getElementById(id);\n\t\tif(iframe.attachEvent){  \n\t\t\tiframe.attachEvent(\"onload\", function(){\n\t\t\t\tiframe.height = iframe.contentWindow.document.documentElement.scrollHeight;\n\t\t\t});\n\t\t\treturn;\n\t\t}else{\n\t\t\tiframe.onload = function(){\n\t\t\t\tiframe.height = iframe.contentDocument.body.scrollHeight; \n\t\t\t};\n\t\t\treturn;\n\t\t}\n\t}catch(e){\n\t\tthrow new Error('setIframeHeight Error');\n\t}\t\n}\n\n//attachEvent——兼容：IE7、IE8；不兼容firefox、chrome、IE9、IE10、IE11、safari、opera\n//scrollHeight  这个只读属性是一个元素内容高度的度量，包括由于溢出导致的视图中不可见内容。(就是页面文档内容的高度)\n\n<\/script>\n\n")])])])])}),[],!1,null,null,null);e.default=s.exports}}]);